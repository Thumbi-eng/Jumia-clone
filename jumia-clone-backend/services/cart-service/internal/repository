package repository

import (
    "context"
    "errors"
)

type CartItem struct {
    ProductID string
    Quantity  int
}

type CartRepository interface {
    AddItem(ctx context.Context, item CartItem) error
    RemoveItem(ctx context.Context, productID string) error
    GetCart(ctx context.Context) ([]CartItem, error)
}

type InMemoryCartRepository struct {
    items map[string]CartItem
}

func NewInMemoryCartRepository() *InMemoryCartRepository {
    return &InMemoryCartRepository{
        items: make(map[string]CartItem),
    }
}

func (r *InMemoryCartRepository) AddItem(ctx context.Context, item CartItem) error {
    r.items[item.ProductID] = item
    return nil
}

func (r *InMemoryCartRepository) RemoveItem(ctx context.Context, productID string) error {
    if _, exists := r.items[productID]; !exists {
        return errors.New("item not found")
    }
    delete(r.items, productID)
    return nil
}

func (r *InMemoryCartRepository) GetCart(ctx context.Context) ([]CartItem, error) {
    cartItems := make([]CartItem, 0, len(r.items))
    for _, item := range r.items {
        cartItems = append(cartItems, item)
    }
    return cartItems, nil
}