package repository

import "errors"

// Product represents the product model
type Product struct {
    ID    string
    Name  string
    Price float64
}

// Repository defines the interface for product data access
type Repository interface {
    Create(product Product) error
    GetByID(id string) (Product, error)
    Update(product Product) error
    Delete(id string) error
}

// InMemoryRepository is an in-memory implementation of the Repository interface
type InMemoryRepository struct {
    products map[string]Product
}

// NewInMemoryRepository creates a new InMemoryRepository
func NewInMemoryRepository() *InMemoryRepository {
    return &InMemoryRepository{
        products: make(map[string]Product),
    }
}

// Create adds a new product to the repository
func (r *InMemoryRepository) Create(product Product) error {
    if _, exists := r.products[product.ID]; exists {
        return errors.New("product already exists")
    }
    r.products[product.ID] = product
    return nil
}

// GetByID retrieves a product by its ID
func (r *InMemoryRepository) GetByID(id string) (Product, error) {
    product, exists := r.products[id]
    if !exists {
        return Product{}, errors.New("product not found")
    }
    return product, nil
}

// Update modifies an existing product in the repository
func (r *InMemoryRepository) Update(product Product) error {
    if _, exists := r.products[product.ID]; !exists {
        return errors.New("product not found")
    }
    r.products[product.ID] = product
    return nil
}

// Delete removes a product from the repository
func (r *InMemoryRepository) Delete(id string) error {
    if _, exists := r.products[id]; !exists {
        return errors.New("product not found")
    }
    delete(r.products, id)
    return nil
}